<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Cash Tow Me â€“ Driver</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

 <script>

// ---------------- ADD DRIVER ----------------
function addDriver() {
  const name = document.getElementById("name").value.trim();
  const city = document.getElementById("city").value.trim();
  const truck = document.getElementById("truck").value.trim();

  if (!name || !city || !truck) {
    alert("Fill all fields");
    return;
  }

  db.collection("drivers").add({
    name,
    city,
    truck,
    status: "OFF",
    approved: false,
    createdAt: Date.now()
  }).then(() => {
    alert("Driver submitted for approval");
    document.getElementById("name").value = "";
    document.getElementById("city").value = "";
    document.getElementById("truck").value = "";
    loadDrivers();
  });
}

// ---------------- LOAD DRIVERS ----------------
function loadDrivers() {
  const approvedDiv = document.getElementById("approved");
  const pendingDiv = document.getElementById("pending");

  approvedDiv.innerHTML = "";
  pendingDiv.innerHTML = "";

  db.collection("drivers").get().then(snapshot => {
    snapshot.forEach(doc => {
      const d = doc.data();

      if (d.approved) {
        approvedDiv.innerHTML += `
          <div class="card">
            <strong>${d.name}</strong> - ${d.city}<br>
            Status: <strong>${d.status}</strong><br>
            <button onclick="toggleStatus('${doc.id}', '${d.status}')">
              Turn ${d.status === "ON" ? "OFF" : "ON"}
            </button>
          </div>
        `;
      } else {
        pendingDiv.innerHTML += `
          <div class="card">
            ${d.name}
            <button onclick="approveDriver('${doc.id}')">Approve</button>
          </div>
        `;
      }
    });
  });
}

// ---------------- APPROVE DRIVER ----------------
function approveDriver(id) {
  db.collection("drivers").doc(id).update({
    approved: true
  }).then(loadDrivers);
}

// ---------------- TOGGLE STATUS ----------------
function toggleStatus(id, currentStatus) {
  const newStatus = currentStatus === "ON" ? "OFF" : "ON";

  db.collection("drivers").doc(id).update({
    status: newStatus
  }).then(loadDrivers);
}

// ---------------- ADMIN ----------------
function openAdmin() {
  if (prompt("Admin password") === "admin123") {
    loadDrivers();
  } else {
    alert("Wrong password");
  }
}

// ---------------- INIT ----------------
loadDrivers();

</script>


</body>
</html>
