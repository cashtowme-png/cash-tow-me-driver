<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Cash Tow Me â€“ Driver</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<link rel="manifest" href="manifest.json">
<link rel="apple-touch-icon" href="icons/icon-192.png">

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
body {
  margin: 0;
  font-family: -apple-system, BlinkMacSystemFont, sans-serif;
  background: #0f172a;
  color: white;
}

.header {
  background: linear-gradient(135deg, #22c55e, #16a34a);
  padding: 25px;
  text-align: center;
  font-size: 22px;
  font-weight: bold;
  border-bottom-left-radius: 25px;
  border-bottom-right-radius: 25px;
}

.card {
  background: #1e293b;
  margin: 20px;
  padding: 20px;
  border-radius: 20px;
}

input {
  width: 100%;
  padding: 14px;
  margin-bottom: 12px;
  border-radius: 12px;
  border: none;
}

button {
  width: 100%;
  padding: 14px;
  border-radius: 12px;
  border: none;
  margin-top: 10px;
  background: #22c55e;
  color: white;
  font-weight: bold;
}
</style>
</head>

<body>

<div class="header">
ðŸš› Driver Dashboard
</div>

<div class="card">
<h3>Add Company</h3>

<input id="name" placeholder="Driver Name">
<input id="company" placeholder="Company Name">
<input id="phone" placeholder="Phone Number">
<input id="city" placeholder="City">
<input id="truck" placeholder="Truck Type">
<input id="services" placeholder="Services (Flatbed, Winch, Lockout)">

<button onclick="addDriver()">Save Company</button>
<button onclick="goOnline()">Go Online</button>
</div>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyCQyOdOaBj7C65MdvVA-_at7VbsvOqLqIw",
  authDomain: "cash-dispatch.firebaseapp.com",
  projectId: "cash-dispatch",
  storageBucket: "cash-dispatch.appspot.com",
  messagingSenderId: "79166345159",
  appId: "1:79166345159:web:c763c3d806d2fc24db53e2"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

let driverId = null;

function addDriver() {
  const name = document.getElementById("name").value;
  const company = document.getElementById("company").value;
  const phone = document.getElementById("phone").value;
  const city = document.getElementById("city").value;
  const truck = document.getElementById("truck").value;
  const services = document.getElementById("services").value;

  if (!name || !company || !phone || !city || !truck || !services) {
    alert("Fill all fields");
    return;
  }

  db.collection("drivers").add({
    name,
    company,
    phone,
    city,
    truck,
    services,
    approved: true,
    status: "OFF",
    createdAt: Date.now()
  }).then(docRef => {
    driverId = docRef.id;
    alert("Company Saved");
  });
}

function goOnline() {

  if (!driverId) {
    alert("Save company first");
    return;
  }

  navigator.geolocation.getCurrentPosition(position => {

    db.collection("drivers").doc(driverId).update({
      status: "ON",
      latitude: position.coords.latitude,
      longitude: position.coords.longitude
    });

    alert("You are now ONLINE");

  });
}

if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('service-worker.js');
}
</script>

</body>
</html>
