<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Cash Tow Me â€“ Driver</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<link rel="manifest" href="manifest.json">
<link rel="apple-touch-icon" href="icons/icon-192.png">

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
body {
  margin:0;
  font-family:-apple-system, BlinkMacSystemFont, sans-serif;
  background:#0f0f0f;
  color:white;
}

.header {
  padding:20px;
  font-size:24px;
  font-weight:bold;
}

.card {
  background:#1c1c1e;
  margin:20px;
  padding:20px;
  border-radius:20px;
}

input {
  width:100%;
  padding:14px;
  margin-bottom:12px;
  border-radius:12px;
  border:none;
  font-size:16px;
}

button {
  width:100%;
  padding:16px;
  border:none;
  border-radius:14px;
  font-size:16px;
  font-weight:bold;
  margin-bottom:10px;
}

.btn-primary {
  background:#ff3b30;
  color:white;
}

.btn-secondary {
  background:#2c2c2e;
  color:white;
}
</style>
</head>

<body>

<div class="header">
ðŸš› Cash Tow Me â€“ Driver
</div>

<div class="card">
<input id="name" placeholder="Driver Name">
<input id="company" placeholder="Company Name">
<input id="phone" placeholder="Phone Number">
<input id="city" placeholder="City">
<input id="truck" placeholder="Truck Type">
<input id="services" placeholder="Services (Flatbed, Winch, Lockout)">

<button class="btn-primary" onclick="addDriver()">Add Driver</button>
<button class="btn-secondary" onclick="openAdmin()">Admin Panel</button>
</div>

<div id="adminSection" style="display:none;">
  <div class="card">
    <h3>All Drivers</h3>
    <div id="allDrivers"></div>
  </div>
</div>

<script>

const firebaseConfig = {
 apiKey: "AIzaSyCQyOdOaBj7C65MdvVA-_at7VbsvOqLqIw",
  authDomain: "cash-dispatch.firebaseapp.com",
  projectId: "cash-dispatch",
  storageBucket: "cash-dispatch.appspot.com",
  messagingSenderId: "79166345159",
  appId: "1:79166345159:web:c763c3d806d2fc24db53e2"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

function addDriver() {
  const name = document.getElementById("name").value;
  const company = document.getElementById("company").value;
  const phone = document.getElementById("phone").value;
  const city = document.getElementById("city").value;
  const truck = document.getElementById("truck").value;
  const services = document.getElementById("services").value;

  if (!name || !company || !phone || !city || !truck || !services) {
    alert("Fill all fields");
    return;
  }

  db.collection("drivers").add({
    name,
    company,
    phone,
    city,
    truck,
    services,
    approved: false,
    status: "OFF",
    createdAt: Date.now()
  });

  alert("Driver Added");
}

function openAdmin() {
  const password = prompt("Enter Admin Password");
  if (password === "admin123") {
    document.getElementById("adminSection").style.display = "block";
    loadDrivers();
  } else {
    alert("Wrong password");
  }
}

function loadDrivers() {
  const container = document.getElementById("allDrivers");

  db.collection("drivers").onSnapshot(snapshot => {
    container.innerHTML = "";

    snapshot.forEach(doc => {
      const d = doc.data();

      container.innerHTML += `
        <div style="margin-bottom:20px; padding:15px; background:#222; border-radius:12px;">
          <strong>${d.company}</strong><br>
          Driver: ${d.name}<br>
          Status: ${d.status}<br>
          Services: ${d.services}<br><br>

          <button onclick="toggleStatus('${doc.id}', '${d.status}')">
            ${d.status === "ON" ? "ðŸŸ¢ Go Offline" : "ðŸ”´ Go Online"}
          </button>
        </div>
      `;
    });
  });
}
function toggleStatus(id, currentStatus) {

  if (currentStatus === "OFF") {

    navigator.geolocation.getCurrentPosition(position => {

      db.collection("drivers").doc(id).update({
        status: "ON",
        latitude: position.coords.latitude,
        longitude: position.coords.longitude,
        lastUpdated: Date.now()
      });

    });

  } else {

    db.collection("drivers").doc(id).update({
      status: "OFF",
      latitude: null,
      longitude: null
    });

  }

}
loadDrivers();
